#!/usr/bin/env node

'use strict';

const fs = require('fs');
const path = require('path');
const Generator = require('../lib/Generator');

const yargs = require('yargs')
  .usage('Usage: $0 [COMMAND] [OPTIONS]') // PATH | URL | -
  .example('$0 generate -o ../my-csar', 'Generate CSAR')
  .command('generate', 'Generate TOSCA CSAR')
  .command('gen', 'Alias for generate')
  .demand(1, 'Must provide a valid command'),
  argv = yargs.argv,
  command = argv._[0];

if (command === 'generate' || command === 'gen') {
  const argvGen = yargs.reset()
    .usage('Usage: $0 [COMMAND] [OPTIONS]') // PATH | URL | -
    .example('$0 generate -o ../my-csar', 'Generate CSAR')

    .help('h')
    .alias('h', 'help')

    .describe('s', 'Path to CSAR spec')
    .alias('s', 'spec')
    .string()
    .normalize('s')
    .nargs('s', 1)

    .describe('c', 'Path to working dir used as context')
    .alias('c', 'context')
    .string()
    .normalize('c')
    .nargs('c', 1)
    //.default('c', process.cwd())

    .describe('o', 'Path to output dir')
    .alias('o', 'output')
    .string()
    .normalize('o')
    .nargs('o', 1)
    .demand(['output'])

    .describe('camelize', 'Convert names to camelCase')
    .boolean('camelize')

    .argv;
 
  argvGen.context = argvGen.context || process.cwd();
  argvGen.spec = argvGen.spec || path.join(argvGen.context, 'csarspec.json');

  Generator().generate(fs.readFileSync(argvGen.spec, 'utf8'), {
    workingDir: argvGen.context,
    outputDir: argvGen.output,
    camelize: argvGen.camelize
  }, (err) => {
    if (err) throw err;
    else console.log('done');
  });
/*} else if (command === 'world'){
  yargs.reset()
    .usage('$0 world')
    .help('h')
    .example('$0 world', 'print the world message!')
    .argv
 
  console.log('world!');*/
} else {
  yargs.showHelp();
}
